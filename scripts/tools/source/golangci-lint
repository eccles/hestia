#
# Installs go linter
#
# This file is sourced
#
. ./scripts/source/log
. ./scripts/source/environment

GOLANG_LINT_CMD=golangci-lint
GOLANG_LINT_VERSION=1.45.2

golangci-lint_install() {
        TEMPDIR=$( mktemp -d /tmp/.${GOLANG_LINT_CMD}.XXXXXXXX )
        function finalise {
                CODE=$?
                log_info "Delete ${TEMPDIR}"
                rm -rf "${TEMPDIR}"
                exit "$CODE"
        }
        trap finalise EXIT INT TERM
	(cd "${TEMPDIR}" \
	&& local="${GOROOT}/bin" \
	&& log_info "Downloading installation script" \
        && curl -fsSOL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh  \
	&& log_info "Install ${GOLANG_LINT_CMD} ${GOLANG_LINT_VERSION} in ${local}" \
        && sh ./install.sh -b "${local}" "v${GOLANG_LINT_VERSION}")
}
golangci-lint_version() {
	${GOLANG_LINT_CMD} --version | cut -d' ' -f4
}
golangci-lint_which() {
	echo "$(which ${GOLANG_LINT_CMD}) $(golangci-lint_version)"
}
